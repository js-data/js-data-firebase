/*!
* js-data-firebase
* @version 3.0.0-beta.1 - Homepage <https://github.com/js-data/js-data-firebase>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2016 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-firebase/blob/master/LICENSE>
*
* @overview firebase adapter for js-data.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("js-data"),require("js-data-adapter"),require("firebase")):"function"==typeof define&&define.amd?define("js-data-firebase",["exports","js-data","js-data-adapter","firebase"],e):e(t.JSDataFirebase=t.JSDataFirebase||{},t.JSData,t.Adapter,t.Firebase)}(this,function(t,e,n,r){"use strict";function i(t){s.push(t)}function u(){s.length&&!l&&(l=!0,s[0]())}function o(t){s.length?i(t):(i(t),u())}function a(t){return new e.utils.Promise(t).then(function(t){return l=!1,s.shift(),setTimeout(u,0),t},function(t){return l=!1,s.shift(),setTimeout(u,0),e.utils.reject(t)})}function f(t){e.utils.classCallCheck(this,f),t||(t={}),e.utils.fillIn(t,d),n.Adapter.call(this,t),(t.baseRef||t.basePath)&&(this.baseRef=t.baseRef||new r(t.basePath))}r="default"in r?r.default:r;var c={};c.slicedToArray=function(){function t(t,e){var n=[],r=!0,i=!1,u=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,u=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw u}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var s=[],l=!1,h=n.Adapter.prototype,d={basePath:""};f.prototype=Object.create(n.Adapter.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),Object.defineProperty(f,"__super__",{configurable:!0,value:n.Adapter}),f.extend=e.utils.extend,e.utils.addHiddenPropsToTarget(f.prototype,{_count:function(t,e,n){return e||(e={}),n||(n={}),this._findAll(t,e,n).then(function(t){return t[0]=t[0].length,t})},_create:function(t,e,n){return e||(e={}),n||(n={}),this._upsert(t,e,n)},_upsert:function(t,n,r){var i=this,u=e.utils.plainCopy(n);r||(r={});var o=e.utils.get(u,t.idAttribute),a=this.getRef(t,r),f=void 0;return e.utils.isSorN(o)?f=a.child(o):(f=a.push(),e.utils.set(u,t.idAttribute,f.key())),f.set(u).then(function(){return i._once(f)}).then(function(t){if(!t)throw new Error("Not Found");return[t,{ref:f}]})},_upsertBatch:function(t,n,r){var i=this;r||(r={});var u=t.idAttribute,o=[],a=this.getRef(t,r);return n.forEach(function(t){var n=e.utils.get(t,u),r=e.utils.plainCopy(t),i=void 0;e.utils.isSorN(n)?i=a.child(n):(i=a.push(),e.utils.set(r,u,i.key())),o.push({ref:i,props:r})}),this._atomicUpdate(o).then(function(){return e.utils.Promise.all(o.map(function(t){return i._once(t.ref)}))}).then(function(t){return[t,{ref:o.map(function(t){return t.ref})}]})},_once:function(t){return t.once("value").then(function(t){return t.exists()?t.val():null})},_atomicUpdate:function(t){var e=this,n={};return t.forEach(function(t){n[t.ref.toString().replace(e.baseRef.toString(),"")]=t.props}),this.baseRef.update(n)},_createMany:function(t,e,n){return n||(n={}),this._upsertBatch(t,e,n)},_destroy:function(t,e,n){n||(n={});var r=this.getRef(t,n).child(e);return r.remove().then(function(){return[void 0,{ref:r}]})},_destroyAll:function(t,n,r){var i=this;return n||(n={}),r||(r={}),this._findAll(t,n).then(function(n){var u=c.slicedToArray(n,1),o=u[0],a=t.idAttribute;return e.utils.Promise.all(o.map(function(n){return i._destroy(t,e.utils.get(n,a),r)}))}).then(function(){return[void 0,{}]})},_find:function(t,e,n){n||(n={});var r=this.getRef(t,n).child(e);return this._once(r).then(function(t){return[t,{ref:r}]})},_findAll:function(t,n,r){n||(n={}),r||(r={});var i=this.getRef(t,r);return i.once("value").then(function(t){var r=t.val();if(!r)return[[],{ref:i}];var u=[];e.utils.forOwn(r,function(t,e){u.push(t)});var o=new e.Query({index:{getAll:function(){return u}}});return[o.filter(n).run(),{ref:i}]})},_sum:function(t,n,r,i){return this._findAll(t,r,i).then(function(t){return t[0]=t[0].reduce(function(t,r){return t+(e.utils.get(r,n)||0)},0),t})},_update:function(t,n,r,i){var u=this;r||(r={}),i||(i={});var o=this.getRef(t,i).child(n);return this._once(o).then(function(t){if(!t)throw new Error("Not Found");return e.utils.deepMixIn(t,r),o.set(t)}).then(function(){return u._once(o)}).then(function(t){if(!t)throw new Error("Not Found");return[t,{ref:o}]})},_updateAll:function(t,n,r,i){var u=this;return i||(i={}),n||(n={}),r||(r={}),this._findAll(t,r,i).then(function(r){var o=c.slicedToArray(r,1),a=o[0];return a.forEach(function(t){return e.utils.deepMixIn(t,n)}),u._upsertBatch(t,a,i)})},_updateMany:function(t,e,n){return n||(n={}),this._upsertBatch(t,e,n)},getRef:function(t,e){return e=e||{},this.baseRef.child(e.endpoint||t.endpoint||t.name)},create:function(t,e,n){var r=this;return a(function(i,u){o(function(){h.create.call(r,t,e,n).then(i,u)})})},createMany:function(t,e,n){var r=this;return a(function(i,u){o(function(){h.createMany.call(r,t,e,n).then(i,u)})})},destroy:function(t,e,n){var r=this;return a(function(i,u){o(function(){h.destroy.call(r,t,e,n).then(i,u)})})},destroyAll:function(t,e,n){var r=this;return a(function(i,u){o(function(){h.destroyAll.call(r,t,e,n).then(i,u)})})},update:function(t,e,n,r){var i=this;return a(function(u,a){o(function(){h.update.call(i,t,e,n,r).then(u,a)})})},updateAll:function(t,e,n,r){var i=this;return a(function(u,a){o(function(){h.updateAll.call(i,t,e,n,r).then(u,a)})})},updateMany:function(t,e,n){var r=this;return a(function(i,u){o(function(){h.updateMany.call(r,t,e,n).then(i,u)})})}});var p={beta:1,full:"3.0.0-beta.1",major:3,minor:0,patch:0};t.FirebaseAdapter=f,t.version=p,t.default=f});
//# sourceMappingURL=js-data-firebase.min.map